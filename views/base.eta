<!DOCTYPE html>
<%
const {
  breadcrumbs, childPages, childTags, backlinkPages, taggedIndexLinks,
  indexLayout, page, site, includeRefresh
} = it;

const { title, description, date, tags, headings, html } = page;
%>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title !== site.title ? `${title} Â· ${site.title}` : site.title %></title>
    <meta name="description" content="<%= description ?? site.description %>">
    <link rel="stylesheet" href="/ter.css">
    <link rel="stylesheet" href="/hljs.css">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="<%= title ?? site.title %>">
    <meta name="twitter:description" content="<%= description ?? site.description %>">
    <meta property="og:type" content="article">
    <meta property="og:title" content="<%= title ?? site.title %>">
    <meta property="og:description" content="<%= description ?? site.description %>">
    <meta property="og:url" content="<%= site.url %>">
    <%~ include("head") %>
  </head>

  <body>

    <% if (includeRefresh) { %>
    <%~ includeFile('refresh') %>
    <% } %>


    <main>
      <% if (html) { %>
      <article>
        <%~ html %>
      </article>
      <% } %>

      <% if (indexLayout === "log") { %>
        <% childPages.forEach((page) => {
          const {title, description, date, tags, html, url} = page;
        %>
        <article>
          <h2><a href="<%= url.pathname %>"><%~ title %></a></h2>

          <div class="metadata">
            <% if (description) { %>
            <div><%= description %></div>
            <% } %>

            <div>
              <% if (date) { %>
              <time class="metadata-time" datetime="<%= date %>"><%= date.toLocaleDateString() %></time>
              <% } %>

              <% if (tags && tags.length > 0 ) { %>
              <ul class="metadata-tags">
                <% tags.forEach((tag) => { %>
                <li class="metadata-tags-tag">
                  <a href="<%= `/tag/${tag}` %>"><%~ tag %></a>
                </li>
                <% }) %>
              </ul>
              <% } %>
            </div>
          </div>

          <%~ html %>
        </article>

        <% }) %>
      <% } %>
    </main>

    <aside>
      <% if (breadcrumbs) { %>
      <nav aria-label="breadcrumbs">
        <ol class="breadcrumbs">
          <% breadcrumbs.forEach((crumb) => { %>
            <li class="breadcrumbs-item
            <%_= crumb.isTag ? ' breadcrumbs-item--tag' : '' %>
            <%_= crumb.current ? ' breadcrumbs-item--current' : '' %>">
              <% if (crumb.url !== "") { %>
              <a href="<%= crumb.url %>"><%= crumb.slug %></a>
              <% } else { %>
              <%= crumb.slug %>
              <% } %>
            </li>
          <% }) %>
        </ol>
      </nav>
      <% } %>


      <% if (description) { %>
      <div class="metadata">
        <div class="metadata-key">Description</div>
        <div><%= description %></div>
      </div>
      <% } %>

      <% if (date) { %>
      <div class="metadata">
        <div class="metadata-key">Date</div>
        <time class="metadata-value" datetime="<%= date %>"><%= date.toLocaleDateString() %></time>
      </div>
      <% } %>

      <% if (headings?.length > 0) { %>
      <div class="metadata">
        <div class="metadata-key">Contents</div>
        <ul class="metadata-value">
          <% headings.forEach((heading) => { %>
          <li><a href="#<%= heading.slug %>"><%_= heading.text _%></a></li>
          <% }) %>
        </ul>
      </div>
      <% } %>

      <% if (childPages?.length > 0) { %>
      <div class="metadata">
        <div class="metadata-key">Child pages</div>
        <ul class="metadata-value">
          <% childPages.forEach((page) => {
            const {pinned, isIndex, url, description, title, date } = page; %>
          <li>
            <a href="<%= url.pathname %>"><%= title %></a>
            <% if (date) { %>
              <time datetime="<%= date %>"><%= date.toLocaleDateString() %></time>
            <% } %>
          </li>
          <% }) %>
      </div>
      <% } %>

      <% if (childTags?.length > 0) { %>
      <div class="metadata">
        <div class="metadata-key">Child tags</div>
        <ul class="metadata-value">
          <% childTags.forEach((tag) => { %>
          <li><a href="<%= `/tag/${tag}` %>"><%_= tag _%></a></li>
          <% }) %>
        </ul>
      </div>
      <% } %>

      <% if (backlinkPages?.length > 0) { %>
      <div class="metadata">
        <div class="metadata-key">Backlinks</div>
        <ul class="metadata-value">
          <% backlinkPages.forEach((page) => {
            const {pinned, isIndex, url, description, title, date } = page; %>
          <li>
            <a href="<%= url.pathname %>"><%= title %></a>
            <% if (date) { %>
              <time datetime="<%= date %>"><%= date.toLocaleDateString() %></time>
            <% } %>
          </li>
          <% }) %>
        </ul>
      </div>
      <% } %>

      <% taggedIndexLinks?.length > 0 && Object.keys(taggedIndexLinks).forEach((tag) => { %>
      <div class="metadata">
        <div class="metadata-key"><a href=<%= `/tag/${tag}` %>><%= `Tagged ${tag}` %></a></div>
        <ul class="metadata-value">
          <% taggedIndexLinks[tag].forEach((page) => {
            const {isIndex, url, title, date } = page; %>
          <li>
            <a href="<%= url.pathname %>"><%= title %></a>
            <% if (date) { %>
              <time datetime="<%= date %>"><%= date.toLocaleDateString() %></time>
            <% } %>
          </li>
          <% }) %>
        </ul>
      </div>
      <% }) %>

    </aside>
<!--<footer>
      Made with <a href="https://github.com/kkga/ter">Ter</a>.
    </footer> -->
  </body>
</html>
